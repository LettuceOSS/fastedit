name: Continuous Integration

on:
  pull_request:
    branches:
      - 'main'

jobs:
  Test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Download and install FFmpeg
        run: |
          # Creating FFmpeg directory
          mkdir -p $HOME/ffmpeg
          cd $HOME/ffmpeg

          # Downloading FFmpeg
          wget https://johnvansickle.com/ffmpeg/releases/ffmpeg-7.0.2-amd64-static.tar.xz
          
          # Archive extraction
          tar -xf ffmpeg-7.0.2-amd64-static.tar.xz --strip-components=1
          
          # Add directory to $PATH
          echo "$HOME/ffmpeg" >> $GITHUB_PATH
      - name: Verify FFmpeg installation
        run: ffmpeg -version
      - name: Upgrade pip
        run: pip install --upgrade pip
      - name: Install test dependencies
        run: pip install -e .[test]
      - name: Perform test
        run: pytest
  Quality:
    needs: Test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Upgrade pip
        run: pip install --upgrade pip
      - name: Install lint dependencies
        run: pip install -e .[lint]
      - name: Perform lint
        run: flake8